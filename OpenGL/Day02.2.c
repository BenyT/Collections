#define DEBUG
#include <GL/glut.h>
#include <math.h>
#include <stdio.h>
#include <stdlib.h>
#define Clear() glClear(GL_COLOR_BUFFER_BIT)

static GLubyte Mask[128] =
{
     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
     0x03, 0x80, 0x01, 0xC0, 0x06, 0xC0, 0x03, 0x60, 
     0x04, 0x60, 0x06, 0x20, 0x04, 0x30, 0x0C, 0x20, 
     0x04, 0x18, 0x18, 0x20, 0x04, 0x0C, 0x30, 0x20, 
     0x04, 0x06, 0x60, 0x20, 0x44, 0x03, 0xC0, 0x22, 
     0x44, 0x01, 0x80, 0x22, 0x44, 0x01, 0x80, 0x22, 
     0x44, 0x01, 0x80, 0x22, 0x44, 0x01, 0x80, 0x22,
     0x44, 0x01, 0x80, 0x22, 0x44, 0x01, 0x80, 0x22, 
     0x66, 0x01, 0x80, 0x66, 0x33, 0x01, 0x80, 0xCC, 
     0x19, 0x81, 0x81, 0x98, 0x0C, 0xC1, 0x83, 0x30, 
     0x07, 0xE1, 0x87, 0xE0, 0x03, 0x3F, 0xFC, 0xC0, 
     0x03, 0x31, 0x8C, 0xC0, 0x03, 0x3F, 0xFC, 0xC0, 
     0x06, 0x64, 0x26, 0x60, 0x0C, 0xCC, 0x33, 0x30, 
     0x18, 0xCC, 0x33, 0x18, 0x10, 0xC4, 0x23, 0x08, 
     0x10, 0x63, 0xC6, 0x08, 0x10, 0x30, 0x0C, 0x08, 
     0x10, 0x18, 0x18, 0x08, 0x10, 0x00, 0x00, 0x08 
};

/* Draw an image using a mask array. */
void drawImageAsMask(void)
{
	Clear();
	glEnable(GL_POLYGON_STIPPLE);

	glPolygonStipple(Mask);
	glRectf(-1.0f, -1.0f, 0.0f, 0.0f);
	glDisable(GL_POLYGON_STIPPLE);
	glRectf(0.0f, 0.0f, 1.0f, 1.0f);

	glFlush();
}

/* Draw an image using a mask bitmap. */
void drawImageAsFile(void)
{
	static GLubyte uMask[128];
	FILE* fp = 0;
	fp = fopen("E:\\Projects\\lab\\lab\\file\\mask.bmp", "rb");
	if(!fp)
	{
		exit(0);
	}
	if(fseek(fp, -(int)sizeof(uMask), SEEK_END))
	{
		exit(0);
	}
	if(!fread(uMask, sizeof(uMask), 1, fp))
	{
		exit(0);
	}
	fclose(fp);

	Clear();
	glEnable(GL_POLYGON_STIPPLE);

	glPolygonStipple(uMask);
	glRectf(-1.0f, -1.0f, 0.0f, 0.0f);
	glDisable(GL_POLYGON_STIPPLE);
	glRectf(0.0f, 0.0f, 1.0f, 1.0f);

	glFlush();
}

int main(int argc, char* argv[])
{
	glutInit(&argc, argv);
	
	glutInitDisplayMode(GLUT_RGB | GLUT_SINGLE);
	glutInitWindowPosition(100, 100);
	glutInitWindowSize(400, 400);
	
	glutCreateWindow("The first OpenGL programme.");
	glutDisplayFunc(&drawImageAsFile);
	glutMainLoop();

	return 0;
}
